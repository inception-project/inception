# Default values for inception.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# -- Custom Helm Release name.
nameOverride: ""

# -- Custom Helm Release full name.
fullnameOverride: ""

# -- Number of replicas fir INCEpTION deployment.
replicaCount: 1

# Extra annotations for INCEpTION's pod.
podAnnotations: {}

# Extra labels for INCEpTION's pod.
podLabels: {}

# -- User-defined init-container to run before INCEpTION pod, as defined in [Kubernetes documentation](https://kubernetes.io/docs/concepts/workloads/pods/init-containers/).
initContainers: {}

# -- User-defined extra containers to run alongside INCEpTION pod, as defined in [Kubernetes documentation](https://kubernetes.io/docs/concepts/workloads/pods/#using-pods).
extraContainers: {}

# -- Extra environment variables for INCEpTION's container.
extraEnv: {}

# -- Extra volume definition for INCEpTION's pod.
extraVolumes: {}

# -- Extra volume mounts for INCEpTION's pod.
extraVolumeMounts: {}

# -- INCEpTION container image settings.
# @default -- Pulling INCEpTION Image from the official repository.
image:
  # -- Image repository.
  repository: "ghcr.io/inception-project/inception"
  # -- Image Pull Policy.
  pullPolicy: "IfNotPresent"
  # -- Image tag.
  tag: "33.2"

# -- INCEpTION container image Pull Secret.
imagePullSecrets: {}

# -- INCEpTION configuration settings.
# @default -- A pre-configured development deployment (NOT RECOMMENDED FOR PRODUCTION!).
config:
  # -- Base URL prefix on which INCEpTION is deployed.
  baseUrl: "/"
  # -- INCEpTION log level (affects the application and Spring Security framework).
  logging: "INFO"

  # -- INCEpTION security settings.
  # @default -- Unsecure connections to localhost allowed (NOT RECOMMENDED FOR PRODUCTION!).
  security:
    # -- Accepted origin (see [dedicated INCEpTION documentation](https://inception-project.github.io/releases/33.2/docs/admin-guide.html#sect_reverse_proxy)).
    acceptedOrigins: "localhost"
    # -- Allowing HTTP unsecure communications.
    allowHttp: false

  # -- INCEpTION database connection settings.
  # @default -- A pre-configured development database connection (NOT RECOMMENDED FOR PRODUCTION!).
  database:
    # -- Database name.
    name: "inception"
    # -- Database hostname.
    hostname: ""
    # -- Database port.
    port: 3306
    # -- Database SSL communication.
    useSSL: false
    ## -- Database server timezone.
    serverTimezone: "UTC"
    # -- Database authentication settings.
    # @default -- A default insecure connection to the embedded MariaDB database (NOT RECOMMENDED FOR PRODUCTION!).
    auth: 
      # -- INCEpTION username.
      username: "inception"
      # -- INCEpTION password.
      # @default -- Plain text password (NOT RECOMMENDED FOR PRODUCTION!).
      password:
        # -- Password in plain text (NOT RECOMMENDED FOR PRODUCTION!). Ignored if a reference to an external secret is specified.
        value: "t0t4llYSecreT"
        # -- Reference to an external Kubernetes secret in the same namespace holding the password's value.
        # @default -- No reference to any external secret.
        existingSecret:
          # -- Secret name.
          secretName: ""
          # -- Secret key holding the password's value.
          secretKey: ""
  # -- Extra configuration added at the end of the `settings.properties` file, in `key: value` format.
  extraConfig: {}


# -- INCEpTION's authentication configuration.
# @default -- No default admin configured, the admin password will be asked when accessing INCEpTION for the first time.
auth:
  # -- Default Administrator account configuration (see [dedicated INCEpTION documentation](https://inception-project.github.io/releases/33.2/docs/admin-guide.html#_unsupervised_installation)).
  # @default -- Default Adminitrator account disabled.
  defaultAdmin:
    # -- Enabling Default Administrator feature.
    enabled: false
    # -- Default Administrator username.
    username: "admin"
    # -- Default Administrator password.
    # @default -- A default plain-text password (NOT RECOMMENDED FOR PRODUCTION!).
    password: 
      # -- Password in plain text (NOT RECOMMENDED FOR PRODUCTION!). `bcrypt` hash will be derived from that password and stored in the `settings.properties` file.
      #    Ignored if a reference to an external secret is specified. 
      value: "loc@lAdmin!*"
      # -- Reference to an external Kubernetes secret in the same namespac.e holding the password's bcrypt hash's value, in the `{bcrypt}XXXXXX` format.
      # @default -- No reference to an existong secret.
      existingSecret:
        # -- Secret name.
        secretName: ""
        # -- Secret key holding the password's `bcrypt` hash.
        secretKey: ""

  # -- OAuth2 authentication settings (see [dedicated INCEpTION documentation](https://inception-project.github.io/releases/33.2/docs/admin-guide.html#sect_security_authentication_oauth2)).
  # @default -- OAuth2 login disabled.
  oauth2:
    # -- Enabling OAuth2 SSO login.
    enabled: false
    # -- Enabling OAuth2 as default login method (skips INCEpTION's default login page).
    autoLogin: false 
    # -- OAuth2 client name, to be displayed on INCEpTION's login page.
    clientName: ""
    # -- OAUth2 client ID.
    clientID: ""
    # -- OAuth2 client secret.
    # @default -- No client secret provided.
    clientSecret:
      # -- OAuth2 client secret in plain text (NOT RECOMMENDED FOR PRODUCTION!). Ignored if a reference to an external secret is specified.
      value: ""
      # -- Reference to an external Kubernetes secret in the same namespace holding the OAuth2 secret's value.
      # @default -- No reference to an existing secret.
      existingSecret: 
        # -- Secret name.
        secretName: ""
        # -- Secret key holding the OAuth2 client secret's value. 
        secretKey: ""
    # -- OAuth2 scope.
    scope: ""
    # -- OAuth2 grant type.
    authorizationGrantType: ""
    # -- OAuth2 redirect URI.
    redirectURI: ""
    # -- OAuth2 Issuer URI.
    issuerURI: ""
    # -- OAuth2 claim holding the username attribute.
    usernameAttribute: ""

  # -- SAML2 Authentication settings (see [dedicated INCEpTION documentation](https://inception-project.github.io/releases/33.2/docs/admin-guide.html#sect_security_authentication_saml2)).
  # @default -- SAML2 login disabled.
  saml2:
    # -- Enabling SAML2 SSO login.
    enabled: false
    # -- Enabling SAML2 as default login method (skips INCEpTION's default login page).
    autoLogin: false
    # -- SAML2 requests signing with external key and certificate.
    # @default -- SAML2 request signing is disabled.
    signRequest: 
      # -- Enabling SAML2 request signing.
      enabled: false
      # -- Public certificate value un plain text. Ignored if a reference to an external TLS Secret is specified.
      certificateValue: ""
      # -- Private Key value, in plain text (NOT RECOMMENDED FOR PRODUCTION!). Ignored if a reference to an external secret is specified. 
      privateKeyValue: ""
      # -- Reference to an external Kubernetes TLS secret in the same namespace holding the certificate/private key pair to sign the SAML2 requests.
      existingTlsSecret: ""
    # -- Certificate authenticating the Identity Provider in SAML2 connection.
    # @default -- No certificate provided. 
    assertingPartyCertificate:
      # -- Certificate in plain text. Ignored if a reference to an external Secret is specified.
      value: ""
      # -- Reference to an external Kubernetes Secret in the same namespace holding the Identity Provider certificate.
      # @default -- No reference to an existing secret.
      existingSecret: 
        # -- Name of the Secret.
        secretName: ""
        # -- Secret key holding the Identity Provider certificate.
        secretKey: ""
    # -- Identity Provider's SAML2 Asserting ID.
    assertingPartyEntityID: ""
    # -- Identity Provider's SAML2 SSO URL.
    assertingPartySSOUrl: ""

  # -- PreAuthentication settings, not cumulative with OAuth2 and SAML2 authentication modes (see [dedicated INCEpTION documentation](https://inception-project.github.io/releases/33.2/docs/admin-guide.html#sect_security_authentication_preauth)).
  # @default -- Pre-authentication disabled.
  preAuthentication:
    # -- Enabling the PreAuthentication feature.
    enabled: false
    # -- Name of the header holding the remote user name.
    headerPrincipal: ""
    # -- Role given to new pre-authenticated users.
    newUserRole: ""
    # -- Roles to map to dedicated pre-authenticated users, in the `username: role` format.
    customUserRoles: {}

# -- INCEpTION's pod startup probe.
# @default -- Startup probe enabled.
startupProbe:
  # -- Enabling the startup probe.
  enabled: true
  # -- Startup probe initial startup delay.
  initialDelaySeconds: 30
  # -- Startup probe check interval, in seconds.
  periodSeconds: 10
  # -- Startup probe's number of accepted failures.
  failureThreshold: 5

# -- INCEpTION's pod liveness probe.
# @default -- Liveness probe enabled.
livenessProbe:
  # -- Enabling the liveness probe.
  enabled: true
  # -- Liveness probe initial startup delay.
  initialDelaySeconds: 0
  # -- Liveness probe check interval, in seconds.
  periodSeconds: 5
  # -- Liveness probe's number of accepted failures.
  failureThreshold: 2

# -- INCEpTION podSecurityContext.
# @default -- Setup according to the [`baseline` Pod Security Standards](https://kubernetes.io/docs/concepts/security/pod-security-standards/#baseline).
podSecurityContext:
  # -- User ID to run as.
  runAsUser: 2000
  # -- Group ID to run as.
  runAsGroup: 2000
  # -- Group ID authorized to mount external PVCs.
  fsGroup: 2000
  # -- Allowing container(s) to run as root.
  runAsNonRoot: true

# -- INCEpTION's container securityContext.
# @default -- Setup according to the [`baseline` Pod Security Standards](https://kubernetes.io/docs/concepts/security/pod-security-standards/#baseline).
securityContext:
  # -- Enforcing read-only root filesystem (`/`).
  readOnlyRootFilesystem: true
  # -- Enabling running the pod as privileged.
  privileged: false

# -- INCEpTION pod's resources.
resources: {}
  # We usually recommend not to specify default resources and to leave this as a conscious
  # choice for the user. This also increases chances charts run on environments with little
  # resources, such as Minikube. If you do want to specify resources, uncomment the following
  # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

# -- INCEpTION pod horizontal autoscaling feature (not recommended).
# @default -- Horizontal pod autoscaling disabled.
autoscaling:
  # -- Enabling horizontal pod autoscaling.
  enabled: false
  # -- Minimum number of pod replicas.
  minReplicas: 1
  # -- Maximum number of pod replicas.
  maxReplicas: 3
  # -- Target CPU usage percentage to trigger the deployment of a new replica.
  targetCPUUtilizationPercentage: 80
  # -- Target memory usage percentage to trigger the deployment of a new replica.
  targetMemoryUtilizationPercentage: 80

serviceAccount:
  # -- Specifies whether a service account should be created.
  create: true
  # -- Automatically mount a ServiceAccount's API credentials.
  automount: true
  # -- Annotations to add to the service account.
  annotations: {}
  # -- The name of the service account to use.
  #    If not set and create is true, a name is generated using the fullname template.
  name: ""

# -- INCEpTION pod node selector.
nodeSelector: {}

# -- INCEpTION pod tolerations.
tolerations: []

# -- INCEpTION pod affinities.
affinity: {}

# -- INCEpTION data persistence settings.
  # @default -- Requesting a PVC for the data directory.
persistence:
  # Data volume settings.
  # @default -- Requesting a 5Gi volume with the `standard` storage class.
  data:
    # -- Name of the Storage Class to use.
    storageClassName: "standard"
    # -- Requested volume size. 
    size: "5Gi"
    # -- Persistent Volume Claim Access Mode
    accessMode: ReadWriteOnce

# -- Network Policies settings.
# @default -- Network Policies enabled for database and SSO (if Oauth2 or SAML2 login enabled) ingress and egress. 
networkPolicies:
  # -- Enabling the default Network Policies.
  enabled: true

# -- INCEpTION service exposition settings.
# @default -- exposing INCEpTION pod on the `8080` port.
service:
  # -- Service Type 
  type: ClusterIP
  # -- Service Port
  port: 8080

# -- Ingress configuration.
# @default -- Ingress enabled on `localhost`.
ingress:
  # -- Enabling Ingress.
  enabled: true
  # -- Ingress class name.
  className: "nginx"

  # -- Ingress host settings.
  # @default -- Listening on `/` for `localhost`.
  hosts:
    - host: localhost
      paths:
      - path: /
        pathType: Prefix

  # -- Ingress TLS settings.
  tls: []
  #  - secretName: chart-example-tls
  #    hosts:
  #      - chart-example.local


# -- Embedded Bitnami MariaDB Chart settings (see [dedicated Chart documentation](https://artifacthub.io/packages/helm/bitnami/mariadb)).
# @default -- Database enabled with a default unsecure password (NOT RECOMMENDED FOR PRODUCTION!).
mariadb:
  # -- Enabling embedded MariaDB.
  enabled: true
  # -- MariaDB container image settings.
  # @default -- Official MariaDB Bitnami image.
  image:
    # -- Enabling debug logging.
    debug: false

  # -- MariaDB primary server settings.
  # @default -- Setup according to [the dedicated INCEpTION documentation](https://inception-project.github.io/releases/33.0/docs/admin-guide.html#_prepare_database).
  primary: 
    # -- MariaDB service exposition settings.
    # @default -- Exposing the default `3306` port.
    service:
      # -- Service ports settings.
      # @default -- setup to `3306`.
      ports:
        # -- Mariadb `mysql`port.
        mysql: 3306

    # -- MariaDB Primary configuration to be injected as ConfigMap.
    # @default -- Enabled UTF8 character set.
    configuration: |-
      [mysql]
      default-character-set = utf8mb4

      [mysqld]
      skip-name-resolve
      explicit_defaults_for_timestamp
      basedir=/opt/bitnami/mariadb
      datadir=/bitnami/mariadb/data
      plugin_dir=/opt/bitnami/mariadb/plugin
      port=3306
      socket=/opt/bitnami/mariadb/tmp/mysql.sock
      tmpdir=/opt/bitnami/mariadb/tmp
      max_allowed_packet=16M
      bind-address=*
      pid-file=/opt/bitnami/mariadb/tmp/mysqld.pid
      log-error=/opt/bitnami/mariadb/logs/mysqld.log
      slow_query_log=0
      long_query_time=10.0

      character-set-client-handshake = FALSE
      character-set-server = utf8mb4
      collation-server = utf8mb4_bin

      [client]
      port=3306
      socket=/opt/bitnami/mariadb/tmp/mysql.sock
      default-character-set=UTF8
      plugin_dir=/opt/bitnami/mariadb/plugin
      default-character-set = utf8mb4

      [manager]
      port=3306
      socket=/opt/bitnami/mariadb/tmp/mysql.sock


  # -- MariaDB authentication settings for the custom database.
  # @default -- Plain-text default authentication settings (NOT RECOMMENDED FOR PRODUCTION!).
  auth:
    # -- Name for a custom database to create.
    database: "inception"
    # -- Name for a custom user to create.
    username: "inception"
    # -- Password for the new user, in plain text (NOT RECOMMENDED FOR PRODUCTION!). Ignored if existing secret is provided.
    password: "t0t4llYSecreT"
    # -- Use existing secret for password details (auth.rootPassword, auth.password, auth.replicationPassword will be ignored and picked up from this secret). 
    #    The secret has to contain the keys `mariadb-root-password`, `mariadb-replication-password` and `mariadb-password`.
    existingSecret: ""

  # -- Network Policies settings.
  # @default -- NetworkPolicies enabled.
  networkPolicy:
    # -- Enable creation of NetworkPolicy resources.
    enabled: true
    # -- The Policy model to apply.
    allowExternal: false